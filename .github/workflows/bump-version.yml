name: Bump clang-tools binaries version
on:
  push:
    branches:
      - "main"
  pull_request:
    branches:
        - "main"
  workflow_dispatch:

jobs:
  bump_version:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: pip install requests

    - name: Bump version
      run: |
        cd .github/workflows
        latest_tag=`python3 bump-version.py`

        cd ${{ github.workspace }}

        if git diff --exit-code; then
          echo "No changes detected."
          exit 0
        fi

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.CPP_LINTER_TOKEN }}
        add-paths: "clang_tools/__init__.py"
        commit-message: "chore: bump clang-tools-static-binaries to $latest_tag"
        title: "Bump cpp-linter/clang-tools-static-binaries to $latest_tag"
        body: |
          Bump [cpp-linter/clang-tools-static-binaries](https://github.com/cpp-linter/clang-tools-static-binaries/releases)
          - Updated with *today's* date
          - Auto-generated by [create-pull-request][1]

          [1]: https://github.com/peter-evans/create-pull-request
        base: main
        labels: dependencies
        branch: bump-clang-tools-static-binaries-version
        delete-branch: true
